// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  CENADI_DIRECTOR
  DIVISION_DIRECTOR
  DIVISION_SECRETARY
}

enum Division {
  DEP
  DEL
  DTB
  DIRE
  DAAF
}

model User {
  id            String          @id @default(cuid())
  name          String?
  email         String          @unique
  password      String
  role          Role            @default(DIVISION_SECRETARY)
  division      Division?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  lastLogin     DateTime?
  searchHistory SearchHistory[]
  activities    ActivityLog[]
}

model SearchHistory {
  id           String   @id @default(cuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  query        String
  resultsCount Int      @default(0)
  createdAt    DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

enum ActivityType {
  LOGIN
  LOGOUT
  SEARCH
  DOCUMENT_VIEW
  DOCUMENT_UPLOAD
  DOCUMENT_DELETE
  USER_CREATE
  USER_UPDATE
  USER_DELETE
  SETTINGS_CHANGE
}

model ActivityLog {
  id          String       @id @default(cuid())
  userId      String
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  type        ActivityType
  description String
  metadata    Json?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime     @default(now())

  @@index([userId])
  @@index([type])
  @@index([createdAt])
}
